# apache-security.conf - Configuração de segurança do servidor Web

# 1. ESCONDER INFORMAÇÕES DO SERVIDOR (Versão e SO)
ServerTokens Prod
ServerSignature Off

# 2. CONFIGURAÇÃO GERAL DO DIRETÓRIO RAIZ
<Directory /var/www/html>
    Options -Indexes +FollowSymLinks
    AllowOverride None
    Require all granted
    
</Directory>

# 3. CABEÇALHOS DE SEGURANÇA (HEADERS)
# Protege contra Clickjacking, XSS, etc.
<IfModule mod_headers.c>
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    Header always unset X-Powered-By
</IfModule>

# 4. BLOQUEIO DE ARQUIVOS SENSÍVEIS (REGEX)
# Bloqueia: arquivos ocultos (.), backups, logs, configs, sql, enc, txt, yml, docker
<FilesMatch "^\.">
    Require all denied
</FilesMatch>

<FilesMatch "(^#.*#|\.(bak|config|dist|fla|inc|ini|log|psd|sh|sql|sw[op]|enc|yml|yaml|txt))$">
    Require all denied
</FilesMatch>

# 5. BLOQUEIO DE NOMES ESPECÍFICOS
# Proteção redundante para arquivos críticos de infraestrutura (por garantia)
<FilesMatch "^(Dockerfile|docker-compose\.yml|composer\.json|composer\.lock|package\.json)$">
    Require all denied
</FilesMatch>

# 6. BLOQUEIO DE SCRIPTS ESPECÍFICOS
# Impede acesso direto, mas permite que outros PHPs façam include dele
<Files "mailer.php">
    Require all denied
</Files>

# 7. BLOQUEIO DE DIRETÓRIOS INTERNOS (pasta 'includes' e 'sql')
<Directory /var/www/html/BookShell/includes>
    Require all denied
</Directory>

<Directory /var/www/html/BookShell/sql>
    Require all denied
</Directory>
